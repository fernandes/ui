<%
  # Button - ERB Partial
  #
  # A versatile button component with multiple variants and sizes.
  # Uses ButtonBehavior module for shared styling logic.
  #
  # @param content [String] Button text content (alternative to using block)
  # @param variant [String] Visual style variant (default, destructive, outline, secondary, ghost, link)
  # @param size [String] Size variant (default, sm, lg, icon, icon-sm, icon-lg)
  # @param type [String] Button type attribute (button, submit, reset)
  # @param disabled [Boolean] Whether the button is disabled
  # @param classes [String] Additional CSS classes to merge
  # @param attributes [Hash] Additional HTML attributes
  #
  # Supports splatting attributes from parent components (e.g., **trigger_attrs)
  # When attributes are splatted, data/class/id are merged from local_assigns

  @variant = local_assigns.fetch(:variant, "default")
  @size = local_assigns.fetch(:size, "default")
  @type = local_assigns.fetch(:type, "button")
  @disabled = local_assigns.fetch(:disabled, false)
  @classes = local_assigns.fetch(:classes, "")
  @attributes = local_assigns.fetch(:attributes, {})
  content_param = local_assigns.fetch(:content, nil)

  # Support for splatted attributes (e.g., **trigger_attrs)
  # Merge data and class from local_assigns if present (from splatting)
  splatted_data = local_assigns.fetch(:data, {})
  splatted_class = local_assigns.fetch(:class, nil)

  # Merge splatted attributes into @attributes
  if splatted_data.present?
    @attributes = @attributes.deep_merge(data: splatted_data)
  end
  if splatted_class.present?
    @attributes[:class] = TailwindMerge::Merger.new.merge([@attributes[:class], splatted_class].compact.join(" "))
  end

  extend UI::ButtonBehavior
  base_attrs = button_html_attributes

  # Merge classes using TailwindMerge to properly combine button classes with passed attributes
  merged_class = TailwindMerge::Merger.new.merge([
    base_attrs[:class],
    @attributes[:class]
  ].compact.join(" "))

  # Deep merge other attributes, then set the merged class
  all_attributes = base_attrs.deep_merge(@attributes.except(:class))
  all_attributes[:class] = merged_class
%>
<%= content_tag :button, all_attributes do %>
  <%= content_param || yield %>
<% end %>
